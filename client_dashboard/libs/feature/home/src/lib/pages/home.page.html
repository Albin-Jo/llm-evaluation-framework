<div class="dashboard-container">
  <!-- Dashboard Header -->
  <header class="dashboard-header">
    <h1>RAG Evaluation Framework</h1>
    <p class="subtitle">Monitor and analyze your RAG system performance</p>
  </header>

  <!-- Dashboard Stats -->
  <div class="dashboard-stats">
    <div class="stat-card" (click)="viewAllDatasets()">
      <div class="stat-icon datasets-icon">
        <i class="bi bi-database"></i>
      </div>
      <div class="stat-content">
        <span class="stat-count">{{datasetsCount || 0}}</span>
        <span class="stat-label">Datasets</span>
      </div>
    </div>

    <div class="stat-card" (click)="viewAllPrompts()">
      <div class="stat-icon prompts-icon">
        <i class="bi bi-chat-text"></i>
      </div>
      <div class="stat-content">
        <span class="stat-count">{{promptsCount || 0}}</span>
        <span class="stat-label">Prompts</span>
      </div>
    </div>

    <div class="stat-card" (click)="viewAllEvaluations()">
      <div class="stat-icon evaluations-icon">
        <i class="bi bi-clipboard-check"></i>
      </div>
      <div class="stat-content">
        <span class="stat-count">{{evaluationsCount || 0}}</span>
        <span class="stat-label">Evaluations</span>
      </div>
    </div>

    <div class="stat-card" (click)="viewAllReports()">
      <div class="stat-icon reports-icon">
        <i class="bi bi-file-earmark-bar-graph"></i>
      </div>
      <div class="stat-content">
        <span class="stat-count">{{reportsCount || 0}}</span>
        <span class="stat-label">Reports</span>
      </div>
    </div>
  </div>

  <!-- Dashboard Tabs -->
  <div class="dashboard-tabs">
    <div class="tab-headers">
      <div class="tab-header" [class.active]="activeTab === 'datasets'" (click)="setActiveTab('datasets')">Recent Datasets</div>
      <div class="tab-header" [class.active]="activeTab === 'prompts'" (click)="setActiveTab('prompts')">Recent Prompts</div>
      <div class="tab-header" [class.active]="activeTab === 'evaluations'" (click)="setActiveTab('evaluations')">Recent Evaluations</div>
    </div>

    <!-- Datasets Tab -->
    <div class="tab-content" *ngIf="activeTab === 'datasets'">
      <div class="tab-header-actions">
        <h3>Recent Datasets</h3>
        <qrac-button label="Create Dataset" theme="primary" (click)="createDataset()"></qrac-button>
      </div>

      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading datasets...</p>
      </div>

      <div class="datasets-list" *ngIf="!isLoading && datasets.length > 0">
        <div class="dataset-card" *ngFor="let dataset of datasets" (click)="viewDataset(dataset)">
          <div class="dataset-header">
            <h4>{{dataset.name}}</h4>
            <span class="status-badge" [ngClass]="dataset.status.toLowerCase()">{{dataset.status}}</span>
          </div>
          <div class="dataset-description" *ngIf="dataset.description">
            <p>{{dataset.description | slice:0:120}}{{dataset.description.length > 120 ? '...' : ''}}</p>
          </div>
          <div class="dataset-stats">
            <span class="stat">{{dataset.documentCount || 0}} documents</span>
            <span class="stat" *ngIf="dataset.size">{{formatFileSize(dataset.size)}}</span>
            <span class="stat" *ngIf="dataset.format">{{dataset.format}}</span>
          </div>
          <div class="dataset-date">
            <span>Created: {{dataset.createdAt | date:'MMM d, y'}}</span>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="!isLoading && datasets.length === 0">
        <p>No datasets available. Create your first dataset to get started.</p>
        <qrac-button label="Create Dataset" theme="primary" (click)="createDataset()"></qrac-button>
      </div>

      <div class="view-all-link" *ngIf="!isLoading && datasets.length > 0">
        <a (click)="viewAllDatasets()">View all datasets</a>
      </div>
    </div>

    <!-- Prompts Tab -->
    <div class="tab-content" *ngIf="activeTab === 'prompts'">
      <div class="tab-header-actions">
        <h3>Recent Prompts</h3>
        <qrac-button label="Create Prompt" theme="primary" (click)="viewAllPrompts()"></qrac-button>
      </div>

      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading prompts...</p>
      </div>

      <div class="prompts-list" *ngIf="!isLoading && recentPrompts.length > 0">
        <div class="prompt-card" *ngFor="let prompt of recentPrompts" (click)="viewPrompt(prompt)">
          <div class="prompt-header">
            <h4>{{prompt.name}}</h4>
            <span class="status-badge" [ngClass]="prompt.is_public ? 'ready' : 'processing'">{{prompt.is_public ? 'Public' : 'Private'}}</span>
          </div>
          <div class="prompt-description" *ngIf="prompt.description">
            <p>{{prompt.description | slice:0:120}}{{prompt.description.length > 120 ? '...' : ''}}</p>
          </div>
          <div class="prompt-preview">
            <p>{{prompt.content | slice:0:100}}{{prompt.content.length > 100 ? '...' : ''}}</p>
          </div>
          <div class="prompt-meta">
            <span>Created: {{prompt.created_at | date:'MMM d, y'}}</span>
            <span *ngIf="prompt.version">v{{prompt.version}}</span>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="!isLoading && recentPrompts.length === 0">
        <p>No prompts available. Create your first prompt template to get started.</p>
        <qrac-button label="Create Prompt" theme="primary" (click)="viewAllPrompts()"></qrac-button>
      </div>

      <div class="view-all-link" *ngIf="!isLoading && recentPrompts.length > 0">
        <a (click)="viewAllPrompts()">View all prompts</a>
      </div>
    </div>

    <!-- Evaluations Tab -->
    <div class="tab-content" *ngIf="activeTab === 'evaluations'">
      <div class="tab-header-actions">
        <h3>Recent Evaluations</h3>
        <qrac-button label="Start New Evaluation" theme="primary" (click)="startNewEvaluation()"></qrac-button>
      </div>

      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading evaluations...</p>
      </div>

      <div class="evaluations-list" *ngIf="!isLoading && recentEvaluations.length > 0">
        <div class="evaluation-card" *ngFor="let evaluation of recentEvaluations" (click)="viewEvaluation(evaluation)">
          <div class="evaluation-header">
            <h4>{{evaluation.name}}</h4>
            <span class="status-badge" [ngClass]="evaluation.status.toLowerCase()">{{evaluation.status}}</span>
          </div>
          <div class="evaluation-details">
            <div class="detail"><span class="label">Dataset:</span> {{evaluation.datasetName}}</div>
            <div class="detail"><span class="label">Prompt:</span> {{evaluation.promptName}}</div>
            <div class="detail"><span class="label">Models:</span> {{evaluation.modelCount}} models</div>
          </div>
          <div class="evaluation-metrics" *ngIf="evaluation.status === 'completed'">
            <div class="metric">
              <span class="metric-label">Relevance</span>
              <span class="metric-value">{{evaluation.avgRelevance | number:'1.2-2'}}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Latency</span>
              <span class="metric-value">{{evaluation.avgLatency}}ms</span>
            </div>
          </div>
          <div class="evaluation-date">
            <span>Created: {{evaluation.createdAt | date:'MMM d, y'}}</span>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="!isLoading && recentEvaluations.length === 0">
        <p>No evaluations available. Start your first evaluation to compare models.</p>
        <qrac-button label="Start New Evaluation" theme="primary" (click)="startNewEvaluation()"></qrac-button>
      </div>

      <div class="view-all-link" *ngIf="!isLoading && recentEvaluations.length > 0">
        <a (click)="viewAllEvaluations()">View all evaluations</a>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <span>Loading dashboard data...</span>
  </div>
</div>
