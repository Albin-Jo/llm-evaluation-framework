<!-- Path: libs/feature/llm-eval/src/lib/pages/agents/agents-create-edit/agents-create-edit.page.html -->
<div class="agent-create-edit-container">
  <div class="form-header">
    <h1 class="page-title">{{ isEditMode ? 'Edit Agent' : 'Create New Agent' }}</h1>
    <p class="page-description">
      {{ isEditMode ? 'Update the details of this agent' : 'Configure a new LLM agent for evaluation' }}
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading agent details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="error-icon">‚ùå</div>
    <p>{{ error }}</p>
    <button *ngIf="agentId" class="retry-button" (click)="loadAgent(agentId)">
      Try Again
    </button>
  </div>

  <!-- Form -->
  <div *ngIf="!isLoading && !error" class="form-container">
    <form [formGroup]="agentForm" (ngSubmit)="onSubmit()" class="agent-form">
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2 class="section-title">Basic Information</h2>

        <div class="form-row">
          <div class="form-field">
            <qrac-textbox
              [label]="'Agent Name'"
              [controlName]="'name'"
              formControlName="name"
              [placeholder]="'Enter agent name'"
              [required]="true">
            </qrac-textbox>
            <div *ngIf="hasError('name', 'required')" class="error-message">
              Name is required
            </div>
            <div *ngIf="hasError('name', 'maxlength')" class="error-message">
              Name cannot exceed 255 characters
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <qrac-text-area
              [label]="'Description'"
              [controlName]="'description'"
              formControlName="description"
              [placeholder]="'Enter agent description'"
              [rows]="3">
            </qrac-text-area>
          </div>
        </div>

        <div class="form-row two-columns">
          <div class="form-field">
            <qrac-select
              [label]="'Domain'"
              [controlName]="'domain'"
              formControlName="domain"
              [options]="domainOptions"
              [required]="true">
            </qrac-select>
            <div *ngIf="hasError('domain', 'required')" class="error-message">
              Domain is required
            </div>
          </div>

          <div class="form-field">
            <qrac-select
              [label]="'Status'"
              [controlName]="'is_active'"
              formControlName="is_active"
              [options]="statusOptions">
            </qrac-select>
          </div>
        </div>

        <div class="form-row two-columns">
          <div class="form-field">
            <qrac-textbox
              [label]="'Model Type'"
              [controlName]="'model_type'"
              formControlName="model_type"
              [placeholder]="'e.g., gpt-4, claude-3, llama-70b'">
            </qrac-textbox>
          </div>

          <div class="form-field">
            <qrac-textbox
              [label]="'Version'"
              [controlName]="'version'"
              formControlName="version"
              [placeholder]="'e.g., 1.0.0'">
            </qrac-textbox>
            <div *ngIf="hasError('version', 'pattern')" class="error-message">
              Version must follow semantic versioning format (e.g., 1.0.0)
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <qrac-textbox
              [label]="'Tags'"
              [controlName]="'tags'"
              formControlName="tags"
              [placeholder]="'Enter tags separated by commas'">
            </qrac-textbox>
            <div class="field-hint">
              Add tags separated by commas (e.g., "openai, gpt4, production")
            </div>
          </div>
        </div>
      </div>

      <!-- API Configuration Section -->
      <div class="form-section">
        <h2 class="section-title">API Configuration</h2>

        <div class="form-row">
          <div class="form-field">
            <qrac-textbox
              [label]="'API Endpoint'"
              [controlName]="'api_endpoint'"
              formControlName="api_endpoint"
              [placeholder]="'Enter API endpoint URL'"
              [required]="true">
            </qrac-textbox>
            <div *ngIf="hasError('api_endpoint', 'required')" class="error-message">
              API endpoint is required
            </div>
            <div class="field-hint">
              The URL endpoint where this agent can be accessed for evaluation
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <qrac-text-area
              [label]="'Configuration (JSON)'"
              [controlName]="'config'"
              formControlName="config"
              [placeholder]="'Enter JSON configuration'"
              [rows]="8">
            </qrac-text-area>
            <div class="field-hint">
              Configuration parameters as JSON object (e.g., {{ "{" }}"temperature": 0.7, "max_tokens": 1000{{ "}" }})
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="onCancel()">
          Cancel
        </button>
        <button type="submit" class="submit-button" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-small"></span>
          {{ isEditMode ? 'Update Agent' : 'Create Agent' }}
        </button>
      </div>
    </form> <!-- Only one closing form tag -->
  </div>
</div>